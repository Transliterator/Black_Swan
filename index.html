

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Black Swan Sequence</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
    }
    .control-row {
      margin-bottom: 10px;
    }
    .grid {
      display: grid;
      gap: 4px;
      margin-top: 10px;
    }
    .grid input {
      width: 60px;
      text-align: center;
    }
    .row {
      display: flex;
      gap: 4px;
      margin-bottom: 6px;
    }
    canvas {
      margin-top: 20px;
      border: 1px solid #ccc;
    }
  </style>
</head>
<body>
  <h2>Black Swan Sequence</h2>

  <div class="control-row">
    <label>Enter number of cells in row: </label>
    <input type="number" id="cellCount" value="10" min="1" max="100">
  </div>
  <div class="control-row">
    <label>Enter maximum value of random number: </label>
    <input type="number" id="maxValue" value="10" min="1">
  </div>
  <div class="control-row">
    <label>Enter effect value: </label>
    <input type="number" id="effectValue" value="2" step="0.1">
  </div>
  <button onclick="generateSequence()">Apply</button>

  <div class="grid" id="numberGrid"></div>

  <canvas id="chart1" width="1600" height="200"></canvas>
  <canvas id="chart2" width="1600" height="200"></canvas>
  <canvas id="chart3" width="1600" height="200"></canvas>

  <button onclick="generateSequence()">Apply</button>

  <script>
    function generateSequence() {
      const count = parseInt(document.getElementById("cellCount").value);
      const maxVal = parseInt(document.getElementById("maxValue").value);
      const effect = parseFloat(document.getElementById("effectValue").value);
      const grid = document.getElementById("numberGrid");

      const rowA = [], rowB = [], rowC = [];
      grid.innerHTML = "";

      for (let i = 0; i < 3; i++) {
        const row = document.createElement("div");
        row.className = "row";
        grid.appendChild(row);
      }

      for (let i = 0; i < count; i++) {
        const a = Math.floor(Math.random() * maxVal) + 1;
        const b = Math.floor(Math.random() * maxVal) + 1;
        const sum = a + b;

        rowA.push(a);
        rowB.push(b);
        rowC.push(sum);
      }

      const maxSum = Math.max(...rowC);
      rowC.forEach((val, i) => {
        if (val === maxSum) {
          const k = 1 + Math.random(); // RND ∈ [0,1), k ∈ [1,2)
          rowC[i] = val * effect * k;
        }
      });

      // Render grid
      [rowA, rowB, rowC].forEach((rowData, rowIndex) => {
        const row = grid.children[rowIndex];
        rowData.forEach(value => {
          const input = document.createElement("input");
          input.type = "number";
          input.value = value.toFixed(2);
          input.readOnly = true;
          row.appendChild(input);
        });
      });

      // Draw charts
      drawChart("chart1", rowA, "Row A", "gray");
      drawChart("chart2", rowB, "Row B", "blue");
      drawChart("chart3", rowC, "Row C", "green");
    }

    let charts = [];

    function drawChart(canvasId, data, label, color) {
      const ctx = document.getElementById(canvasId).getContext("2d");

      // Destroy previous chart if exists
      const existingChart = charts.find(c => c.canvasId === canvasId);
      if (existingChart) {
        existingChart.chart.destroy();
        charts = charts.filter(c => c.canvasId !== canvasId);
      }

      const chart = new Chart(ctx, {
        type: "line",
        data: {
          labels: data.map((_, i) => i + 1),
          datasets: [{
            label,
            data,
            borderColor: color,
            borderWidth: 2,
            fill: false,
            tension: 0.3
          }]
        },
        options: {
          responsive: false,
          scales: {
            x: {
              title: { display: true, text: 'Index' }
            },
            y: {
              title: { display: true, text: 'Value' },
              beginAtZero: false
            }
          }
        }
      });

      charts.push({ canvasId, chart });
    }
  </script>
</body>
</html>
